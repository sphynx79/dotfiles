{{ if eq .chezmoi.os "windows" -}}

@echo off
setlocal

set SOURCE={{ .chezmoi.sourceDir }}\dot_config\vim
set DEST=%USERPROFILE%\vimfiles

echo Sincronizzazione Vim files...

:: Controllo se ci sono dei file differenti
robocopy.exe "%SOURCE%" "%DEST%" /L /MIR /R:1 /W:1 /NFL /NDL /NJH /NJS /XD "plugged" "info" "log" "session" "undo" "view" > nul

if errorlevel 1 (
    echo Rilevate modifiche, sincronizzazione in corso...
    robocopy.exe "%SOURCE%" "%DEST%" /MIR /R:1 /W:1 /NFL /NDL /NJH /NJS /XD "plugged" "info" "log" "session" "undo" "view"
    timeout /t 3 /nobreak > nul

    :: Cartella per i plugin
    if not exist "%DEST%\plugged" mkdir "%DEST%\plugged"

    :: Cartelle per i file di stato di Vim
    if not exist "%DEST%\files"         mkdir "%DEST%\files"
    if not exist "%DEST%\files\info"    mkdir "%DEST%\files\info"
    if not exist "%DEST%\files\log"     mkdir "%DEST%\files\log"
    if not exist "%DEST%\files\session" mkdir "%DEST%\files\session"
    if not exist "%DEST%\files\undo"    mkdir "%DEST%\files\undo"
    if not exist "%DEST%\files\view"    mkdir "%DEST%\files\view"
    
    echo Sincronizzazione completata.
    echo Installazione plugin Vim...
    vim.exe -c "PlugInstall" -c "qa"
    echo Plugin installati.

) else (
    echo Nessuna modifica rilevata.
)

{{ end -}}
